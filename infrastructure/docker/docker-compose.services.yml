services:
  agent-runtime:
    image: oven/bun:1
    working_dir: /app
    command: bun run services/agent-runtime/src/index.ts
    volumes:
      - ../../:/app
    ports:
      - '${AGENT_RUNTIME_PORT:-3001}:3001'
    env_file: ../../.env
    depends_on:
      postgres:
        condition: service_healthy
      redis:
        condition: service_healthy

  wallet-engine:
    image: oven/bun:1
    working_dir: /app
    command: bun run services/wallet-engine/src/index.ts
    volumes:
      - ../../:/app
    ports:
      - '${WALLET_ENGINE_PORT:-3002}:3002'
    env_file: ../../.env
    depends_on:
      postgres:
        condition: service_healthy
      redis:
        condition: service_healthy

  transaction-engine:
    image: oven/bun:1
    working_dir: /app
    command: bun run services/transaction-engine/src/index.ts
    volumes:
      - ../../:/app
    ports:
      - '${TRANSACTION_ENGINE_PORT:-3004}:3004'
    env_file: ../../.env
    depends_on:
      postgres:
        condition: service_healthy
      redis:
        condition: service_healthy
      wallet-engine:
        condition: service_started

  defi-integration:
    image: oven/bun:1
    working_dir: /app
    command: bun run services/defi-integration/src/index.ts
    volumes:
      - ../../:/app
    ports:
      - '${DEFI_ENGINE_PORT:-3005}:3005'
    env_file: ../../.env
    depends_on:
      redis:
        condition: service_healthy

  api-gateway:
    image: oven/bun:1
    working_dir: /app
    command: bun run apps/api-gateway/src/index.ts
    volumes:
      - ../../:/app
    ports:
      - '${API_GATEWAY_PORT:-8080}:8080'
    env_file: ../../.env
    depends_on:
      - agent-runtime
      - wallet-engine
      - transaction-engine
